version: "1.0"
method: PUT
path: "/role_permissionses/:id/update"
description: "Actualizar role_permission"

auth:
  required: true
  permissions: ["role_permissionses.write"]

params:
  path:
    - name: id
      type: string
      required: true
      validation:
        min: 1
      error_message: "Debe proporcionar un ID v√°lido"
  
  body:
    - name: "role_id"
      type: "int"
      required: false
      validation:
        max: 2147483647
        min: -2147483648
    - name: "permission_id"
      type: "int"
      required: false
      validation:
        max: 2147483647
        min: -2147483648
    - name: "assigned_at"
      type: "string"
      required: false
    - name: "assigned_by"
      type: "int"
      required: false
      validation:
        max: 2147483647
        min: -2147483648

commands:
  # Verificar que existe
  - type: validation
    sql: "SELECT COUNT(*) as count FROM role_permissions WHERE role_id = :id"
    condition: "count = 0"
    on_true:
      action: stop
      http_code: 404
      message: "role_permission no encontrado"
  
  # Actualizar
  - type: exec
    sql: |
      UPDATE role_permissions SET
          
          role_id = COALESCE(:role_id, role_id)
          ,
          permission_id = COALESCE(:permission_id, permission_id)
          ,
          assigned_at = COALESCE(:assigned_at, assigned_at)
          ,
          assigned_by = COALESCE(:assigned_by, assigned_by)
      WHERE role_id = :id
      RETURNING *

response:
  success:
    code: 200
    message: "role_permission actualizado exitosamente"

hooks:
  after:
    - type: cache_invalidate
      keys: ["role_permissionses:list:*", "role_permissionses:{id}"]