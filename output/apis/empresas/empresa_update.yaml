version: "1.0"
method: PUT
path: "/empresases/:id/update"
description: "Actualizar empresa"

auth:
  required: true
  permissions: ["empresases.write"]

params:
  path:
    - name: id
      type: int
      required: true
      validation:
        min: 1
      error_message: "Debe proporcionar un ID válido"
  
  body:
    - name: "nombre"
      type: "string"
      required: false
      validation:
        max_length: 200
    - name: "ruc"
      type: "string"
      required: false
      validation:
        max_length: 20
      description: "RUC único de la empresa"
    - name: "direccion"
      type: "string"
      required: false
    - name: "telefono"
      type: "string"
      required: false
      validation:
        max_length: 20
        pattern: &#34;^[0-9&#43;\\-\\s\\(\\)]{7,20}$&#34;
    - name: "email"
      type: "string"
      required: false
      validation:
        email: true
        max_length: 255
    - name: "activo"
      type: "bool"
      required: false
      description: "Indica si la empresa está activa (soft delete)"
    - name: "updated_at"
      type: "string"
      required: false

commands:
  # Verificar que existe
  - type: validation
    sql: "SELECT COUNT(*) as count FROM empresas WHERE id = :id AND activo = true"
    condition: "count = 0"
    on_true:
      action: stop
      http_code: 404
      message: "empresa no encontrado"
  
  # Actualizar
  - type: exec
    sql: |
      UPDATE empresas SET
          
          nombre = COALESCE(:nombre, nombre)
          ,
          ruc = COALESCE(:ruc, ruc)
          ,
          direccion = COALESCE(:direccion, direccion)
          ,
          telefono = COALESCE(:telefono, telefono)
          ,
          email = COALESCE(:email, email)
          ,
          activo = COALESCE(:activo, activo)
          ,
          updated_at = COALESCE(:updated_at, updated_at)
        ,updated_at = NOW()
      WHERE id = :id
      RETURNING *

response:
  success:
    code: 200
    message: "empresa actualizado exitosamente"

hooks:
  after:
    - type: cache_invalidate
      keys: ["empresases:list:*", "empresases:{id}"]