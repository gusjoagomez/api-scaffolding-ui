version: "1.0"
method: DELETE
path: "/roles/:id/delete"
description: "Desactivar rol"

auth:
  required: true
  permissions: ["roles.delete"]

params:
  path:
    - name: id
      type: int
      required: true
      validation:
        min: 1
      error_message: "Debe proporcionar ID v√°lido a desactivar"

commands:
  # Verificar que el registro existe
  - type: validation
    sql: "SELECT COUNT(*) as count FROM roles WHERE id = :id"
    condition: "count = 0"
    on_true:
      action: stop
      http_code: 404
      message: "rol no encontrado"

  

  
  # Soft delete (marcar como inactivo o con deleted_at)
  - type: exec
    sql: |
      UPDATE roles SET
        
        deleted_at = NOW()
        
      WHERE id = :id
  

response:
  success:
    code: 200
    message: "rol desactivado exitosamente"

hooks:
  after:
    - type: cache_invalidate
      keys: ["roles:list:*", "roles:{id}"]

audit:
  enabled: true